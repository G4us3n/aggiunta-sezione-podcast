(function(e){function t(t){for(var r,c,i=t[0],s=t[1],l=t[2],d=0,p=[];d<i.length;d++)c=i[d],Object.prototype.hasOwnProperty.call(a,c)&&a[c]&&p.push(a[c][0]),a[c]=0;for(r in s)Object.prototype.hasOwnProperty.call(s,r)&&(e[r]=s[r]);u&&u(t);while(p.length)p.shift()();return o.push.apply(o,l||[]),n()}function n(){for(var e,t=0;t<o.length;t++){for(var n=o[t],r=!0,i=1;i<n.length;i++){var s=n[i];0!==a[s]&&(r=!1)}r&&(o.splice(t--,1),e=c(c.s=n[0]))}return e}var r={},a={app:0},o=[];function c(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,c),n.l=!0,n.exports}c.m=e,c.c=r,c.d=function(e,t,n){c.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},c.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},c.t=function(e,t){if(1&t&&(e=c(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(c.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)c.d(n,r,function(t){return e[t]}.bind(null,r));return n},c.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return c.d(t,"a",t),t},c.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},c.p="/calendario/";var i=window["webpackJsonp"]=window["webpackJsonp"]||[],s=i.push.bind(i);i.push=t,i=i.slice();for(var l=0;l<i.length;l++)t(i[l]);var u=s;o.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("56d7")},"56d7":function(e,t,n){"use strict";n.r(t);n("e260"),n("e6cf"),n("cca6"),n("a79d");var r=n("2b0e"),a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-app",[n("login"),n("v-main",[n("v-container",{attrs:{fluid:""}},[n("router-view"),n("calendar")],1)],1)],1)},o=[],c=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("v-dialog",{ref:"event-dialog",attrs:{width:"290px"},model:{value:e.updateEventOpen,callback:function(t){e.updateEventOpen=t},expression:"updateEventOpen"}},[n("event-editor",{attrs:{id:e.selectedEvent.id,title:e.selectedEvent.title,start:e.selectedEvent.start,color:e.selectedEvent.color,room:e.selectedEvent.resource,end:e.selectedEvent.end}})],1),n("v-app-bar",{attrs:{fixed:""}},[n("v-btn",{staticClass:"ma-2",attrs:{icon:""},on:{click:function(t){return e.loadPrevWeek()}}},[n("v-icon",[e._v("mdi-chevron-left")])],1),e._l(e.rooms,(function(t){return n("v-chip",{key:t.value,staticClass:"ma-2",attrs:{color:"rgb("+t.color+")",outlined:!t.selected},on:{click:function(){return e.enableRoom(t.value)}}},[e._v(e._s(t.text)+" ")])})),n("v-spacer"),e._v(" "+e._s(e.curLocaleDate)+" "),n("v-btn",{on:{click:e.logout}},[n("v-icon",[e._v("LOGOUT")])],1),n("v-btn",{staticClass:"ma-2",attrs:{icon:""},on:{click:function(t){return e.loadNextWeek()}}},[n("v-icon",[e._v("mdi-chevron-right")])],1)],2),n("v-sheet",{staticStyle:{"padding-top":"100px"}},[n("v-col",[n("v-row"),n("v-row",[n("v-calendar",{ref:"calendar",staticStyle:{width:"100%"},attrs:{start:e.calendarStart,end:e.calendarEnd,type:"custom-daily",events:e.filteredEvents,"event-overlap-mode":"stack","event-overlap-threshold":30,"show-month-on-first":"true","first-time":"07:00","interval-count":"18"},on:{"click:event":e.openEventInfo,"mousemove:time":e.createEventPlaceholder}})],1)],1)],1)],1)},i=[],s=n("5530"),l=n("2909"),u=(n("d3b7"),n("d81d"),n("4de4"),n("b0c0"),n("99af"),n("1da1")),d=n("d4ec"),p=n("bee2"),v=n("ade3"),f=(n("96cf"),n("2ca0"),n("ac1f"),n("5319"),n("1276"),n("159b"),n("b64b"),function(){function e(){Object(d["a"])(this,e)}return Object(p["a"])(e,null,[{key:"extractJwtUrl",value:function(){var e=window.location.hash,t="#jwt=";if(e.startsWith(t)){var n=e.replace(t,""),r=this.parseJwt(n);localStorage.setItem("_JWT-".concat(r.aud.replace("api-","")),n),window.location.hash="",window.close()}}},{key:"parseJwt",value:function(e){return JSON.parse(atob(e.split(".")[1]))}},{key:"_getJwt",value:function(e){var t="_JWT-".concat(e),n=localStorage.getItem(t);if(!n)return!1;try{var r=this.parseJwt(n);if(r.exp<Date.now()/1e3)throw"Expired";return n}catch(a){return!1}}},{key:"logout",value:function(){var e=Object(u["a"])(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:n="_JWT-".concat(t),localStorage.removeItem(n);case 2:case"end":return e.stop()}}),e)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"requestToken",value:function(){var e=Object(u["a"])(regeneratorRuntime.mark((function e(t){var n;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(this._getJwt(t)){e.next=7;break}return console.log("check"),this.showLoginForm("https://membri.poliradio.it/login.php?api=generate_JWT&aud=api-".concat(t)),e.next=5,this.sleep(1e3);case 5:e.next=0;break;case 7:if(n=this._getJwt(t),n){e.next=12;break}alert("Internal Error, Please Reload"),e.next=14;break;case 12:return this.hideLoginForm(),e.abrupt("return",n);case 14:case"end":return e.stop()}}),e,this)})));function t(t){return e.apply(this,arguments)}return t}()},{key:"sleep",value:function(e){return new Promise((function(t){return setTimeout(t,e)}))}},{key:"send",value:function(){var e=Object(u["a"])(regeneratorRuntime.mark((function e(t,n,r){var a,o,c;return regeneratorRuntime.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,this.requestToken(t);case 3:return a=e.sent,o=new FormData,Object.keys(r).filter((function(e){return e})).forEach((function(e){return o.append(e,r[e])})),o.append("_JWT",a),e.next=9,fetch("https://membri.poliradio.it/api/".concat(t,"/index.php?action=").concat(n),{method:"POST",body:o});case 9:c=e.sent,e.t0=c.status,e.next=403===e.t0?13:200===e.t0?15:18;break;case 13:return alert("Permission Denied"),e.abrupt("break",19);case 15:return e.next=17,c.json();case 17:return e.abrupt("return",e.sent);case 18:throw"Unhandled Code ".concat(c.status);case 19:e.next=25;break;case 21:e.prev=21,e.t1=e["catch"](0),console.error(e.t1),alert("Internal Error, please reload the page");case 25:case"end":return e.stop()}}),e,this,[[0,21]])})));function t(t,n,r){return e.apply(this,arguments)}return t}()}]),e}());Object(v["a"])(f,"showLoginForm",(function(e){console.log("Logging in for ".concat(e))})),Object(v["a"])(f,"hideLoginForm",(function(){}));var h=f,m=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-card",[n("v-card-title",[n("span",[e._v(e._s(e.parsedStartDate))])]),n("v-card-text",[n("span",[n("v-chip",{staticClass:"ma-2",attrs:{color:e.color}},[e._v(e._s(e.room)+" ")]),e._v(e._s(e.title))],1)]),e.clean?n("v-card-actions",[n("v-btn",{staticClass:"ma-2",on:{click:function(t){return e.approve()}}},[e._v(" Approve")]),n("v-btn",{staticClass:"ma-2",on:{click:function(t){return e.reject()}}},[e._v(" Reject ")])],1):e._e()],1)},b=[],g={name:"EventEditor",props:["id","title","color","room","start","end"],data:function(){return{clean:!0}},computed:{parsedStartDate:function(){var e=new Date(parseInt(this.start));return"".concat(e.toLocaleDateString()," - ").concat(this.pad(e.getHours(),"0",2),":").concat(this.pad(e.getMinutes(),"0",2))}},methods:{pad:function(e,t,n){e="".concat(e);while(e.length<n)e="".concat(t).concat(e);return e},approve:function(){var e=this;this.loading=!0,h.send("calendario","accept",{id:this.id}).then((function(){e.clean=!1}))},reject:function(){var e=this;this.loading=!0,h.send("calendario","reject",{id:this.id}).then((function(){e.clean=!1}))}},watch:{id:function(){this.clean=!0}}},w=g,O=n("2877"),x=n("6544"),k=n.n(x),E=n("8336"),_=n("b0af"),j=n("99d9"),y=n("cc20"),D=Object(O["a"])(w,m,b,!1,null,null,null),T=D.exports;k()(D,{VBtn:E["a"],VCard:_["a"],VCardActions:j["a"],VCardText:j["b"],VCardTitle:j["c"],VChip:y["a"]});var I={components:{EventEditor:T},name:"Calendar",data:function(){return{type:"",newEventDate:"sss",rooms:[{text:"Studio1",value:"room-studio1",selected:!0,color:"0,0,255"},{text:"Studio2",value:"room-studio2",selected:!0,color:"255,0,0"},{text:"Palinsesto",value:"room-palinsesto",selected:!0,color:"47,209,6"},{text:"PILLS",value:"room-pills",selected:!0,color:"244,149,151"}],palinsesto:[],selectedTimestamp:0,selectedEvent:{},updateEventOpen:!1,selectedRooms:[],events:[],eventPlaceholders:[],loading:!1,refreshInterval:null,jwtRoles:[]}},mounted:function(){var e=this;console.log("ciao"),this.refreshData(),this.refreshInterval=setInterval(this.refreshData.bind(this),1e4),this.selectedTimestamp=this.roundWeek(Date.now()),fetch("https://www.poliradio.it/api/getPalinsesto.php").then((function(e){return e.json()})).then((function(t){return e.palinsesto=t})),this.selectedDate=(new Date).toISOString()},beforeUnmount:function(){this.refreshInterval&&clearInterval(this.refreshInterval)},computed:{curLocaleDate:function(){return new Date(this.selectedTimestamp).toLocaleDateString()},calendarStart:function(){return this.selectedTimestamp},calendarEnd:function(){return this.selectedTimestamp+6048e5},filteredEvents:function(){var e=this,t=this.rooms.filter((function(e){var t=e.selected;return 1==t})).map((function(e){var t=e.value;return t})),n=36e5,r=24*n,a=this.palinsesto.map((function(t){var a=e.roundWeek(e.selectedTimestamp)+t.day*r,o=new Date(a);o.setHours(t.hour);var c=new Date(o.getTime()+n);return{name:"[ONAIR] ".concat(t.name),resource:"room-palinsesto",timed:!0,locked:!0,approved:!0,start:o,end:c}})),o=[].concat(Object(l["a"])(this.events),Object(l["a"])(a),Object(l["a"])(this.eventPlaceholders)).filter((function(e){var n=e.resource;return-1!==t.indexOf(n)})).map((function(t){return Object(s["a"])(Object(s["a"])({},t),{},{color:e.getRoomColor(t.resource,"1"!=t.approved)})}));return o}},methods:{logout:function(){h.logout("calendario")},loadNextWeek:function(){this.selectedTimestamp+=6048e5},loadPrevWeek:function(){this.selectedTimestamp-=6048e5},createEventPlaceholder:function(e){var t=Math.floor(18e5*Math.floor(Date.parse("".concat(e.date,"T").concat(e.time,":00"))/18e5)),n=t+36e5;this.eventPlaceholders=this.rooms.map((function(e){var r=e.value;return{start:t,end:n,name:"Nuovo Evento",allDay:"0",timed:!0,resource:r,isPlaceholder:!0}}))},enableRoom:function(e){this.rooms=this.rooms.map((function(t){return Object(s["a"])(Object(s["a"])({},t),{},{selected:t.value==e?!t.selected:t.selected})}))},createEvent:function(e){this.newEventDate="".concat(e.date,"T").concat(e.time),this.id=null,this.updateEventOpen=!0},openEventInfo:function(e){if(e.event.isPlaceholder){if("room-palinsesto"===e.event.resource)return void alert("Impossibile Modificare il Palinsesto");if(-1===this.jwtRoles.indexOf("DIRETTORE_PROGRAMMI")&&"room-pills"===e.event.resource)return void alert("Impossibile Modificare Pills");var t=prompt("Inserisci Titolo Evento");t&&h.send("calendario","add",{title:t,start:e.event.start,end:e.event.end,resource:e.event.resource}).then(this.refreshData)}else e.event.locked||(this.selectedEvent=Object(s["a"])(Object(s["a"])({},e.event),{},{resource:this.rooms.filter((function(t){var n=t.value;return e.event.resource==n}))[0]["text"]}),this.updateEventOpen=!0)},closeEventInfo:function(){this.updateEventOpen=!1},openSelectDateModal:function(){this.selectDateOpen=!0},closeSelectDateModal:function(){this.selectDateOpen=!1},getRoomColor:function(e,t){var n=this.rooms.filter((function(t){var n=t.value;return n===e})).map((function(e){var t=e.color;return t})).reduce((function(e,t){return t}),"0,0,0");return"rgba(".concat(n,",").concat(t?.5:1,")")},refreshData:function(){var e=this;this.loading=!0,h.send("calendario","list",{}).then((function(t){return e.events=t.filter((function(e){return 0==e.deleted})).map((function(e){return Object(s["a"])(Object(s["a"])({},e),{},{start:parseInt(e.start),end:parseInt(e.end),name:"".concat(e.title),timed:!0})}))})).then((function(){return h.requestToken("calendario")})).then((function(t){var n=t.permissions;return e.jwtRoles=n})).then((function(){return e.loading=!1}))},roundDay:function(e){var t=36e5,n=24*t;return Math.floor((e-t)/n*n)},roundWeek:function(e){e=new Date(e);var t=e.getDay(),n=e.getDate()-t+(0==t?-6:1);return e.setHours(0,0,0),new Date(e.setDate(n)).getTime()}},watch:{updateEventOpen:function(){0==this.updateEventOpen&&(this.selectedEvent={id:-1},this.refreshData())}}},P=I,S=n("40dc"),C=n("a4f6"),V=n("62ad"),R=n("169a"),L=n("132d"),M=n("0fd9"),J=n("8dd9"),W=n("2fa4"),A=Object(O["a"])(P,c,i,!1,null,null,null),F=A.exports;k()(A,{VAppBar:S["a"],VBtn:E["a"],VCalendar:C["a"],VChip:y["a"],VCol:V["a"],VDialog:R["a"],VIcon:L["a"],VRow:M["a"],VSheet:J["a"],VSpacer:W["a"]});var N=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("v-dialog",{attrs:{persistent:"","max-width":"290"},model:{value:e.showModal,callback:function(t){e.showModal=t},expression:"showModal"}},[n("v-card",[n("v-card-title",{staticClass:"text-h5"},[e._v(" Logged Out ")]),n("v-card-text",[e._v("Please Login Again"),n("br"),n("a",{attrs:{href:e.url,target:"_blank"}},[e._v("LogIn")])])],1)],1)],1)},U=[],$={name:"Login",data:function(){return{url:null}},created:function(){var e=this;h.showLoginForm=function(t){return e.url=t},h.hideLoginForm=function(){return e.url=null}},computed:{showModal:function(){return null!==this.url}}},q=$,B=Object(O["a"])(q,N,U,!1,null,null,null),H=B.exports;k()(B,{VCard:_["a"],VCardText:j["b"],VCardTitle:j["c"],VDialog:R["a"]});var G={name:"App",components:{Calendar:F,Login:H},data:function(){return{}}},z=G,K=n("7496"),Q=n("a523"),X=n("f6c4"),Y=Object(O["a"])(z,a,o,!1,null,null,null),Z=Y.exports;k()(Y,{VApp:K["a"],VContainer:Q["a"],VMain:X["a"]});var ee=n("f309");r["a"].use(ee["a"]);var te=new ee["a"]({theme:{dark:!1}}),ne=n("8c4f");r["a"].config.productionTip=!1,h.extractJwtUrl(),new r["a"]({vuetify:te,VueRouter:ne["a"],render:function(e){return e(Z)}}).$mount("#app")}});
//# sourceMappingURL=app.708d19fa.js.map